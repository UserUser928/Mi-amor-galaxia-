<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Mi Galaxia Especial ‚Äî Para Mi Amor</title>
  <style>
    /* Estilos CSS para el fondo, el lienzo (canvas) y los elementos de la interfaz (HUD) */
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
    .hud{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
    background:rgba(20,15,35,.25);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:8px;
         backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .hud button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);color:#fff}
    .hud input[type=file]{display:none}
    .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
    background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:#fff;font:12px system-ui}
    .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Arrastra para orbitar ‚Ä¢ Pinch/rueda para acercar ‚Ä¢ Doble toque: ¬°Efecto!</div>
<div id="err" class="error"></div>

<div class="hud">
  <button id="playBtn">‚ñ∂Ô∏é</button>
  <span style="font-size:12px;opacity:.9">Puedes seleccionar tu MP3</span>
  <input type="file" id="pickFile" accept="audio/*">
  <button id="pickBtn">Elegir canci√≥n</button>
  <audio id="audio" preload="none"></audio>
</div>

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
const CONFIG = {
  songFile: 'Labios_de_Cereza_2.m4a', 
  phrases: [
    'MI HELLO KITTY üíó','Mi amorüíó','Guapa üòç','Mi cielo üåå','MI MUJER LA M√ÅS LINDA','TE AMO MUCH√çSIMO','ME ENCANTAS KEILAüòª',' TE AMO KEILA KETLINüíóüíó','TE QUIERO POR SIEMPREüíó','Eres mi todo ‚ú®',
    'Siempre t√∫ ‚ôæÔ∏è','Gracias por estar en mi vida','Te quiero mucho ü•∞','Me encantas üí´','Te aprecioüíó','Amo tu voz ','me encanta tu sonrisa üòä','MI REINA üëë','LINDANGAü´¶üíó','TE QUIERO DETONARüíó',
    'Te adoro üå†','Mi vida üíñ','Sos preciosa ‚ú®','Siempre tan linda ü§≠','Te extra√±o ü´∂',
    'Te pienso üí≠','Amo tus ojitosüòª','Quiero estar contigo üíê','Quiero que seas t√∫ üíñ','Quiero que seamos tu y yoüíó','TE AMOü´∂üèª','TE AMOüíó','TE AMO MUCHO UN MONT√ìN DEMASIADO üíñ','Juntos siempre ‚ôæÔ∏è'
  ],
   imageFiles: [ 
    'c283f57bf7211cc745a96a7f74e6bf5a.jpg', 
    'a2b05b594a8ec91f8d6698e6a06d30b5.jpg', 
    'd93421c1425101c4536e94d823f1f8ee.jpg',
    'cffef69cca00979d431df2e6cfc92070.jpg',
    '11a19099ea1c817cde5779560e5b3e51.jpg',
    'c58eddaa8f4743be88a414460396589c.jpg',
    '43d46d137124d43c010d163155c39940.jpg',
    '1ba65940c4665b7e8f8c39b487ef87d9.jpg',
    'ba88c68484f6e34f4bd9464e8368619d.jpg',
    '92dd0aa53066850202bed8390b39688.jpg',
  ],
};

// =======================
// ==== 1. AUDIO SETUP (CORREGIDO PARA EVITAR BLOQUEOS) ====
// =======================
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');

let songLoaded = false; 

/** Intenta reproducir el audio y actualiza el bot√≥n **/
const togglePlay = async () => {
    // 1. Carga el archivo de la configuraci√≥n S√ìLO la primera vez que se interact√∫a.
    if (!songLoaded) {
        audio.src = CONFIG.songFile;
        songLoaded = true;
    }
    
    try { 
        if (audio.paused) { 
            await audio.play();
            playBtn.textContent = '‚è∏Ô∏é'; 
        } else { 
            audio.pause(); 
            playBtn.textContent = '‚ñ∂Ô∏é'; 
        } 
    }
    catch(e){ 
        // Este error ocurre si el navegador bloquea la reproducci√≥n sin un gesto de usuario.
        alert('Error: El navegador necesita un toque/clic. Por favor, intenta de nuevo el bot√≥n Play, o usa "Elegir canci√≥n" y selecciona un MP3.');
    }
};

// Vincula el bot√≥n de Play a la funci√≥n
playBtn.onclick = togglePlay;

// üí° Mejora: Al elegir una canci√≥n, garantizamos que el audio se cargue y empiece a sonar.
pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
  if (pickFile.files && pickFile.files[0]) {
    const url = URL.createObjectURL(pickFile.files[0]);
    audio.src = url; 
    songLoaded = true; 
    // Intenta reproducir despu√©s de una acci√≥n de usuario (Elegir archivo), lo que suele funcionar.
    audio.play().then(() => playBtn.textContent = '‚è∏Ô∏é').catch(() => {
        alert('Canci√≥n cargada, pero es posible que debas tocar Play (‚ñ∂Ô∏é).');
    });
  }
};


// =========================
// ==== 2. WEBGL SETUP (OPTIMIZADO PARA RENDIMIENTO) ====
// =========================
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ 
    canvas, 
    antialias:true, 
    powerPreference: "high-performance" 
});
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true; 

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.set(0, 0, 80); 
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// LUCES
const ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.8); 
scene.add(ambientLight);

// FONDO: Degradado morado vibrante
function makeBackgroundTexture(size=1024) {
  const c = document.createElement('canvas'); c.width=c.height=size;
  const g = c.getContext('2d');
  const gradient = g.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
  gradient.addColorStop(0, '#300050'); 
  gradient.addColorStop(0.5, '#6A0DAD'); 
  gradient.addColorStop(1, '#300050'); 
  g.fillStyle = gradient;
  g.fillRect(0,0,size,size);
  return new THREE.CanvasTexture(c);
}
scene.add(new THREE.Mesh(new THREE.SphereGeometry(600,64,64),
  new THREE.MeshBasicMaterial({ map: makeBackgroundTexture(), side: THREE.BackSide })));


// Estrellas de Fondo de Rayas Horizontales Luminosas (Efecto Barrido)
const linesGeometry = new THREE.BufferGeometry();
// PART√çCULAS: 4000
const numLines = 4000; 
const linePositions = new Float32Array(numLines * 3);
const lineColors = new Float32Array(numLines * 3);

for (let i = 0; i < numLines; i++) {
    const radius = Math.random() * 500 + 150; 
    const angle = Math.random() * Math.PI * 2;
    const y = (Math.random() - 0.5) * 400; 

    linePositions[i * 3] = Math.cos(angle) * radius;
    linePositions[i * 3 + 1] = y;
    linePositions[i * 3 + 2] = Math.sin(angle) * radius;

    const color = new THREE.Color(Math.random() > 0.5 ? 0xFFFFFF : 0xDDCCFF);
    lineColors[i * 3] = color.r;
    lineColors[i * 3 + 1] = color.g;
    lineColors[i * 3 + 2] = color.b;
}

linesGeometry.setAttribute('position', new THREE.BufferAttribute(linePositions, 3));
linesGeometry.setAttribute('color', new THREE.BufferAttribute(lineColors, 3));

const lineMaterial = new THREE.PointsMaterial({
    size: 0.5, 
    vertexColors: true,
    blending: THREE.AdditiveBlending,
    transparent: true,
    sizeAttenuation: true
});

const linesMesh = new THREE.Points(linesGeometry, lineMaterial);
scene.add(linesMesh);


// ===========================================
// ==== 3. GALAXIA DE FRASES (DENSIDAD ALTA MANTENIDA) ====
// ===========================================
const galaxy = new THREE.Group(); scene.add(galaxy);
// FRASES: ~2850
const totalPhrases = CONFIG.phrases.length * 75; 

// Nuevos par√°metros para una espiral m√°s org√°nica
const spiralTurns = 5;      
const maxRadius = 200;      
const heightFactor = 60;    
const phraseScale = 8;      
const radialRandomness = 0.3; 
const angularRandomness = 0.2; 


for (let i = 0; i < totalPhrases; i++) {
  const text = CONFIG.phrases[i % CONFIG.phrases.length];
  
  const c = document.createElement('canvas');
  c.width = 256; 
  c.height = 32; 
  const g = c.getContext('2d');
  g.font = 'bold 16px Arial'; 
  g.fillStyle = '#fff';
  g.textAlign = 'center';
  g.fillText(text, c.width / 2, c.height / 2); 
  const tex = new THREE.CanvasTexture(c);
  
  const spr = new THREE.Sprite(new THREE.SpriteMaterial({ 
      map: tex, 
      transparent: true,
      blending: THREE.AdditiveBlending 
  }));

  let dist = Math.sqrt(i / totalPhrases) * maxRadius; 
  dist += (Math.random() - 0.5) * maxRadius * radialRandomness;
  dist = Math.max(0, dist); 

  let angle = (i / totalPhrases) * Math.PI * 2 * spiralTurns;
  angle += (Math.random() - 0.5) * Math.PI * angularRandomness;

  const y = (Math.random() - 0.5) * heightFactor * (1 - (dist / maxRadius) * 0.5);

  
  spr.position.set(
    Math.cos(angle) * dist,
    y,
    Math.sin(angle) * dist
  );
  
  spr.scale.set(phraseScale, phraseScale / 5, 1); 
  galaxy.add(spr);
}


// ======================================
// ==== 3.1. GALAXIA DE IM√ÅGENES (UNA SOLA VEZ, ROTANDO Y SEMITRANSPARENTES) ====
// ======================================
const imageGroup = new THREE.Group();
scene.add(imageGroup);

const imageLoader = new THREE.TextureLoader();
const loadedImages = [];
let imagesLoadedCount = 0;

CONFIG.imageFiles.forEach((imagePath, index) => {
    imageLoader.load(imagePath, (texture) => {
        const material = new THREE.SpriteMaterial({ 
            map: texture, 
            transparent: true,
            blending: THREE.AdditiveBlending,
            opacity: 0.6 
        });
        const imageSprite = new THREE.Sprite(material);

        const baseRadius = 100; 
        const imageDist = baseRadius + (Math.random() - 0.5) * 150; 
        const imageAngle = (index / CONFIG.imageFiles.length) * Math.PI * 2 * 3; 
        const imageHeight = (Math.random() - 0.5) * 80; 

        imageSprite.position.set(
            Math.cos(imageAngle) * imageDist,
            imageHeight,
            Math.sin(imageAngle) * imageDist
        );
        
        const imageSize = 25; 
        imageSprite.scale.set(imageSize, imageSize, 1); 

        imageGroup.add(imageSprite);
        loadedImages.push(imageSprite); 
        imagesLoadedCount++;

        if (imagesLoadedCount === CONFIG.imageFiles.length) {
            console.log("Todas las im√°genes cargadas.");
        }
    }, 
    undefined, 
    (error) => {
        console.error('Error al cargar la imagen:', imagePath, error);
    });
});


// ================================
// ==== 4. AGUJERO NEGRO Y HALO ====
// ================================
const coreColor = 0x000000; 
const haloInnerColor = 0x8A2BE2; 
const haloOuterColor = 0xEECCFF; 

const core = new THREE.Mesh(
  new THREE.SphereGeometry(8, 64, 64), 
  new THREE.MeshBasicMaterial({ 
    color: coreColor
  }));
core.scale.set(1.0, 1.0, 1.0); 
scene.add(core);

function makeHaloRingTexture(innerColor, outerColor, size = 512) {
  const c = document.createElement('canvas');
  c.width = c.height = size;
  const g = c.getContext('2d');
  const center = size / 2;
  const gradient = g.createRadialGradient(center, center, 0, center, center, size / 2);
  
  gradient.addColorStop(0.0, 'rgba(0,0,0,0)'); 
  gradient.addColorStop(0.14, 'rgba(0,0,0,0)'); 
  
  gradient.addColorStop(0.16, new THREE.Color(innerColor).getStyle().replace('rgb', 'rgba').replace(')', ', 0.9)')); 
  gradient.addColorStop(0.20, new THREE.Color(outerColor).getStyle().replace('rgb', 'rgba').replace(')', ', 1.0)')); 
  gradient.addColorStop(0.28, new THREE.Color(outerColor).getStyle().replace('rgb', 'rgba').replace(')', ', 0.7)')); 
  
  gradient.addColorStop(0.35, 'rgba(0,0,0,0)'); 
  gradient.addColorStop(1.0, 'rgba(0,0,0,0)');
  
  g.fillStyle = gradient;
  g.fillRect(0, 0, size, size);
  return new THREE.CanvasTexture(c);
}

const haloTexture = makeHaloRingTexture(haloInnerColor, haloOuterColor);
const halo = new THREE.Mesh(
  new THREE.PlaneGeometry(100, 100), 
  new THREE.MeshBasicMaterial({
    map: haloTexture,
    blending: THREE.AdditiveBlending, 
    transparent: true,
    opacity: 1.0, 
    side: THREE.DoubleSide
  }));
halo.rotation.x = -Math.PI / 2; 
scene.add(halo);


// ======================================
// === 5. Anillo de Part√≠culas Circulando (M√ÅXIMA ESTABILIDAD) ===
// ======================================
const orbitingParticles = new THREE.Group();
scene.add(orbitingParticles);

// PART√çCULAS: 3500
const totalOrbitingParticles = 3500; 
const orbitingRadius = 250; 
const orbitingHeight = 100; 

function makeDotCanvas(size = 32) {
    const c = document.createElement('canvas');
    c.width = c.height = size;
    const g = c.getContext('2d');
    g.fillStyle = 'rgba(255,255,255,1)';
    g.beginPath();
    g.arc(size / 2, size / 2, size / 2, 0, Math.PI * 2);
    g.fill();
    return c;
}

for (let i = 0; i < totalOrbitingParticles; i++) {
    const material = new THREE.SpriteMaterial({
        color: new THREE.Color(0xFFFFFF), 
        map: new THREE.CanvasTexture(makeDotCanvas()), 
        blending: THREE.AdditiveBlending,
        transparent: true,
        opacity: Math.random() * 0.8 + 0.2 
    });
    
    const particle = new THREE.Sprite(material);
    
    const angle = Math.random() * Math.PI * 2;
    const currentRadius = orbitingRadius + (Math.random() - 0.5) * 100; 
    
    particle.position.set(
        currentRadius * Math.cos(angle),
        (Math.random() - 0.5) * orbitingHeight, 
        currentRadius * Math.sin(angle)
    );
    particle.scale.set(1.5, 1.5, 1.5); 
    
    orbitingParticles.add(particle);
}


// ======================
// ==== 6. ANIMACI√ìN ====
// ======================
function animate(currentTime){
  requestAnimationFrame(animate);
  const time = currentTime * 0.001;
  
  // 1. Efecto Barrido en estrellas de fondo
  if (linesMesh && linesMesh.geometry) {
    const positions = linesMesh.geometry.attributes.position.array;
    for (let i = 0; i < linesMesh.geometry.attributes.position.count; i++) {
        const factor = 0.005;
        const x = positions[i * 3];
        const z = positions[i * 3 + 2];
        const angle = Math.atan2(z, x) + 0.005;
        const radius = Math.sqrt(x*x + z*z);
        
        positions[i * 3] = radius * Math.cos(angle);
        positions[i * 3 + 2] = radius * Math.sin(angle);
        
        positions[i * 3] *= (1 + factor); 
        positions[i * 3 + 2] *= (1 + factor); 
        
        if (radius > 500) {
            const newRadius = Math.random() * 50 + 100;
            const newAngle = Math.random() * Math.PI * 2;
            positions[i * 3] = newRadius * Math.cos(newAngle);
            positions[i * 3 + 2] = newRadius * Math.sin(newAngle);
        }
    }
    linesMesh.geometry.attributes.position.needsUpdate = true;
  }

  // 2. Animar frases (que miren a la c√°mara)
  galaxy.children.forEach(sprite => {
    sprite.lookAt(camera.position); 
  });
  
  // 3. Animar im√°genes (que miren a la c√°mara)
  imageGroup.children.forEach(sprite => {
    sprite.lookAt(camera.position); 
  });

  // Rotaci√≥n del disco completo de frases y ahora tambi√©n de las im√°genes
  galaxy.rotation.y += 0.005; 
  imageGroup.rotation.y += 0.005; 

  // Rotaci√≥n del anillo de part√≠culas orbitando (AUMENTADA)
  orbitingParticles.rotation.y += 0.01; 


  // Esto se encarga del movimiento de c√°mara y activa el c√°lculo de amortiguaci√≥n (damping)
  controls.update(); 
  renderer.render(scene,camera);
}
animate();

// ======================================
// ==== 7. EFECTO DE DOBLE TOQUE (FX) ====
// ======================================
const fx=document.getElementById('fx'); const ctx2=fx.getContext('2d');
function resizeFx(){fx.width=innerWidth*2;fx.height=innerHeight*2;fx.style.width=innerWidth+'px';fx.style.height=innerHeight+'px';}
resizeFx();addEventListener('resize',resizeFx);
const sparks=[];
function spawn(x,y){for(let i=0;i<20;i++)sparks.push({x:x*2,y:y*2,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,life:1});}
let lastTap=0;
addEventListener('click',e=>{if(performance.now()-lastTap<300)spawn(e.clientX,e.clientY);lastTap=performance.now();});
addEventListener('touchend',e=>{const t=e.changedtouches[0];if(performance.now()-lastTap<300)spawn(t.clientX,t.clientY);lastTap=performance.now();});
function loopFx(){ctx2.clearRect(0,0,fx.width,fx.height);for(let i=sparks.length-1;i>=0;i--){const s=sparks[i];s.x+=s.vx;s.y+=s.vy;s.life-=0.02;ctx2.fillStyle='rgba(255,220,180,'+s.life+')';ctx2.beginPath();ctx2.arc(s.x,s.y,3,0,Math.PI*2);ctx2.fill();if(s.life<=0)sparks.splice(i,1);}requestAnimationFrame(loopFx);}loopFx();
</script>
</body>
</html>
